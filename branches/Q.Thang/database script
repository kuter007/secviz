create table HATFact (
      HyperAlertType varchar2(50) not null,
      FactName varchar2(50) not null,
      FactType   varchar2(50) not null,
      constraint HATFact_pk primary key (HyperAlertType,FactName)
      
);
create table HATPrereq (
      HyperAlertType varchar2(50) not null,
      Predicate varchar2(50) not null,
      ArgPos int not null,
      Arg_ID int,
      ArgName varchar2(50),
      constraint HATPrereq_pk primary key (HyperAlertType,Predicate,ArgPos)
);
create table HATConseq (
      HyperAlertType varchar2(50) not null,
      Predicate varchar2(50) not null,
      ArgPos int not null,
      Arg_ID int,
      ArgName varchar2(50),
      constraint HATConseq_pk primary key (HyperAlertType,Predicate,ArgPos)
);
create table Protocol (
      HyperAlertType varchar2(50) not null,
      Protocol varchar2(50) not null,
      constraint Protocol_pk primary key (HyperAlertType,Protocol)
);
create table Implication (
      P_Arg_ID int not null,
      I_Arg_ID int not null ,
      constraint Implication_pk primary key (P_Arg_ID,I_Arg_ID)
);
create table Predicate (
    Predicate varchar2(50) not null,
    Arg_ID int ,
	ArgPos int not null,
    ArgType varchar2(50) ,
    constraint Predicate_pk primary key (Predicate,ArgPos)
);
create table Alert_Info (
   SensorID int not null ,
   AlertID int not null,
   AlertName varchar2(50),
   Begin_Time date,
   End_Time date,
   SrcIPAddress varchar2(20),
   DestIPAddress varchar2(20),
   SrcPort int ,
   DestPort int,
   constraint Alert_Info_pk primary key (SensorID,AlertID)
);
create table HyperAlertMapping (
  HyperAlertName varchar2(50) not null,
  OriginalName varchar2(50) ,
  HyperAlertType varchar2(50),
  constraint HyperAlertMapping_pk primary key (HyperAlertName)
);
create table CorrelatedAlerts (
  PreparingHyperAlertID int not null,
  PreparedHyperAlertID int not null,
  constraint CorrelatedAlerts_pk primary key (PreparingHyperAlertID,PreparedHyperAlertID)
);
create table HyperAlert (
  HyperAlertID int not null,
  HyperAlertType varchar2(50),
  Begin_Time date,
  End_Time date,
  constraint HyperAlert_pk primary key (HyperAlertID)
);
create table ConseqSet (
  HyperAlertID int not null,
  EncodedPredicate int not null,
  Begin_Time date,
  End_Time date,
  constraint ConseqSet_pk primary key (HyperAlertID,EncodedPredicate)
);
create table PrereqSet (
  HyperAlertID int not null,
  EncodedPredicate int not null,
  Begin_Time date,
  End_Time date,
  constraint PrereqSet_pk primary key (HyperAlertID,EncodedPredicate)
);


ALTER TABLE HATFact ADD 
      CONSTRAINT fk_HATFact
      FOREIGN    KEY (HyperAlertType)
      REFERENCES Protocol(HyperAlertType) ;
alter table HATPrereq add (
constraint fk1_HATPrereq foreign key (HyperAlertType) references Protocol(HyperAlertType),
constraint fk2_HATPrereq foreign key (Predicate,ArgPos) references Predicate(Predicate,ArgPos) 
);
alter table Predicate add 
constraint u_Predicate unique ( Arg_ID) ;
alter table HATConseq add (
   constraint fk1_HATConseq foreign key (HyperAlertType) references Protocol(HyperAlertType),
   constraint fk2_HATConseq foreign key (Predicate,ArgPos) references Predicate(Predicate,ArgPos),
   constraint fk3_HATConseq foreign key (Arg_ID) references Predicate(Arg_ID)
);
alter table Implication add (
  constraint fk1_Implication foreign key (I_Arg_ID) references Predicate(Arg_ID),
   constraint fk2_Implication foreign key (P_Arg_ID) references Predicate(Arg_ID)
);
alter table HyperAlertMapping add
constraint fk_HyperAlertMapping foreign key (HyperAlertType) references Protocol (HyperAlertType);
alter table CorrelatedAlerts add (
   constraint fk1_CorrelatedAlerts foreign key (PreparingHyperAlertID) references HyperAlert (HyperAlertID),
   constraint fk2_CorrelatedAlerts foreign key (PreparedHyperAlertID) references HyperAlert (HyperAlertID)
);
alter table ConseqSet add 
  constraint fk_ConseqSet foreign key (HyperAlertID) references HyperAlert(HyperAlertID);
alter table PrereqSet add
 constraint fk_PrereqSet foreign key (HyperAlertID) references HyperAlert(HyperAlertID);

 drop table HATFact  cascade constraints;
drop table HATPrereq cascade constraints;
drop table HATConseq cascade constraints;
drop table Protocol cascade constraints;
drop table Implication cascade constraints;
drop table Predicate cascade constraints;
drop table Alert_Info cascade constraints;
drop table HyperAlertMapping cascade constraints;
drop table CorrelatedAlerts cascade constraints;
drop table HyperAlert cascade constraints;
drop table ConseqSet cascade constraints;
drop table PrereqSet cascade constraints;
 
 INSERT INTO HATFact (HyperAlertType, FactName, FactType)
    VALUES ('RPC portmap sadmind request TCP',  'SrcIPAddress', 'varchar(15)');
INSERT INTO HATFact (HyperAlertType, FactName, FactType)
    VALUES ('RPC portmap sadmind request TCP',  'SrcPort', 'int');
INSERT INTO HATFact (HyperAlertType, FactName, FactType)
  VALUES ('RPC portmap sadmind request TCP',  'DestIPAddress', 'varchar(15)');
INSERT INTO HATFact (HyperAlertType, FactName, FactType)
  VALUES ('RPC portmap sadmind request TCP',  'DestPort', 'int');
  
 Insert Into Protocol (HyperAlertType, Protocol) Values 
   ('RPC portmap sadmind request TCP', 'SADMIND');
Insert Into Protocol (HyperAlertType, Protocol) Values 
   ('RPC portmap sadmind request TCP', 'RPC');
Insert Into Protocol (HyperAlertType, Protocol) Values 
   ('RPC portmap sadmind request TCP', 'Portmap'); 
